#!/usr/bin/env python
"""mkauthmap -c url.conf -o FILE

Queries CRIC roles .json and put it into /data/srv/state/frontend/etc/
"""


import sys, urllib2, os, os.path
from os import open
from optparse import OptionParser
from tempfile import mkstemp


datain = None
opts = None
args = None
url = "http://cms-cric-dev-3.cern.ch/accounts/user/query/?json&preset=roles"


opt = OptionParser()
opt.add_option("-o", "--out", dest="out", metavar="FILE", help="output file")
opts, args = opt.parse_args()


req = urllib2.Request(url)
response = urllib2.urlopen(req)
content = response.read()

###Until here is working it's shows the dowload file
#print content

###I'm getting a TypeError: an integer is required
fd = mkstemp(dir = os.path.dirname(opts.out))
outfile = os.fdopen(fd, "w")
#print >> outfile , content 